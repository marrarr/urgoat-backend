<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Czat</title>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h1>Czat</h1>
<div id="messages"></div>

<input type="text" id="msg" placeholder="Napisz wiadomość">
<button onclick="send()">Wyślij</button>

<!-- Ukryte pole z czatID -->
<input type="hidden" id="czatID" th:value="${czatID}">

<script>
  const socket = new SockJS('/chat-websocket');
  const stompClient = Stomp.over(socket);

  stompClient.connect({}, () => {
    stompClient.subscribe('/topic/messages', (msg) => {
      const el = document.createElement("p");
      el.innerText = msg.body;
      document.getElementById("messages").appendChild(el);
    });
  });

  function send() {
    const text = document.getElementById("msg").value;
    const czatID = document.getElementById("czatID").value;

    const payload = JSON.stringify({
      czatID: czatID,
      tresc: text
    });

    stompClient.send("/app/send", {}, payload);
  }
</script>
</body>
</html>
